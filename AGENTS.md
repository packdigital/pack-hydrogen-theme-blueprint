# AGENTS.md

## Cursor Cloud specific instructions

### Overview

This is **Pack Blueprint** â€” a Shopify Hydrogen storefront theme (React/TypeScript/Vite) by Pack Digital. It is a single-package application (not a monorepo). All product/content data comes from external APIs (Shopify Storefront API and Pack CMS); there are no local databases.

### Node version

The project requires **Node.js v20** (see `.nvmrc`). Use `nvm use` to activate the correct version.

### Package manager

Uses **npm** (see `package-lock.json`). Run `npm install` for dependencies.

### Common commands

See `package.json` scripts:

| Command | Purpose |
|---------|---------|
| `npm run dev` | Start dev server on port 8080 (Shopify Mini-Oxygen) |
| `npm run build` | Production build via `shopify hydrogen build` |
| `npm run lint` | ESLint check |
| `npm run format:check` | Prettier check |
| `npm run typecheck` | TypeScript type check (`tsc --noEmit`) |

### Environment variables

A `.env` file is required at the project root. The update script generates it automatically from injected environment secrets (`PACK_PUBLIC_TOKEN`, `PACK_SECRET_TOKEN`, `PACK_STOREFRONT_ID`).

The Shopify Hydrogen dev server (Mini-Oxygen) reads tokens **only from the `.env` file**, not from system environment variables. This is a critical gotcha: even if secrets are injected as env vars, Mini-Oxygen will not see them unless they are written to `.env`.

Without valid Pack tokens, the homepage and all CMS-driven pages return 404 (the route loader throws 404 when Pack returns no page data). Shopify Storefront API features (search, products, cart) work with `mock.shop` regardless.

### Gotchas

- **`typecheck` has pre-existing errors**: The `+types/*` modules are auto-generated by React Router during the Vite build, not at rest. Running `tsc --noEmit` standalone will report missing module errors for route type imports. This is a known pattern with React Router v7 file-based routing. The build (`npm run build`) succeeds despite these.
- **`lint` has pre-existing errors**: ~25 ESLint errors and ~4 warnings exist in the codebase (empty blocks, prettier formatting). These are not introduced by setup.
- **React Router version warning**: The Hydrogen CLI warns about a React Router version mismatch (installed 7.12.0 vs expected 7.9.2). The app works correctly despite this warning.
- **Pack CMS is a hard dependency for full content**: The `server.ts` throws if `PACK_SECRET_TOKEN` is missing. With a placeholder token, the server runs but Pack CMS API calls return "Unauthorized" and pages return 404. The Shopify Storefront API features (products, search, cart) still work via `mock.shop`.
- **Mini-Oxygen only reads `.env`**: System environment variables are NOT passed to Mini-Oxygen. All secrets must be written to the `.env` file for the dev server to use them.
- **Dev server port**: The dev server runs on **port 8080** (configured in `package.json` dev script).
